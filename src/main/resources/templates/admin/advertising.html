<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link href="../assets/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="../css/style.css" />
    <link href="../assets/css/codemirror.css" rel="stylesheet">
    <link rel="stylesheet" href="../assets/css/ace.min.css" />
    <link rel="stylesheet" href="font/css/font-awesome.min.css" />


    <link rel="stylesheet" href="../Widget/zTree/css/zTreeStyle/zTreeStyle.css" type="text/css">
    <link rel="stylesheet" href="../assets/css/font-awesome.min.css" />
    <!--[if IE 7]>
    <link rel="stylesheet" href="../assets/css/font-awesome-ie7.min.css" />
    <![endif]-->
    <link href="../Widget/icheck/icheck.css" rel="stylesheet" type="text/css" />
    <link href="../Widget/webuploader/0.1.5/webuploader.css" rel="stylesheet" type="text/css" />

    <!--[if lte IE 8]>
    <link rel="stylesheet" href="../assets/css/ace-ie.min.css" />
    <![endif]-->
    <script src="../js/jquery-1.9.1.min.js"></script>
    <script src="../assets/js/typeahead-bs2.min.js"></script>
    <script src="../js/lrtk.js" type="text/javascript"></script>
    <script src="../assets/js/jquery.dataTables.min.js"></script>
    <script src="../assets/js/jquery.dataTables.bootstrap.js"></script>
    <script src="../assets/layer/layer.js" type="text/javascript"></script>

    <script type="text/javascript" src="../Widget/My97DatePicker/WdatePicker.js"></script>
    <script type="text/javascript" src="../Widget/icheck/jquery.icheck.min.js"></script>
    <script type="text/javascript" src="../Widget/zTree/js/jquery.ztree.all-3.5.min.js"></script>
    <script type="text/javascript" src="../Widget/Validform/5.3.2/Validform.min.js"></script>
    <script type="text/javascript" src="../Widget/webuploader/0.1.5/webuploader.min.js"></script>
    <script type="text/javascript" src="../Widget/ueditor/1.4.3/ueditor.config.js"></script>
    <script type="text/javascript" src="../Widget/ueditor/1.4.3/ueditor.all.min.js"> </script>
    <script type="text/javascript" src="../Widget/ueditor/1.4.3/lang/zh-cn/zh-cn.js"></script>


        <link rel="stylesheet" href="../layui/css/layui.css" media="all">
        <script src="../layui/layui.js" charset="utf-8"></script>


        <!-- <script src="https://cdn.jsdelivr.net/npm/vue@2"></script> -->
        <script src="../js/vue.min.js"></script>

    <title>广告管理</title>

    <style type="text/css">
        .layui-upload-drag-self {
            background-color: #fbfdff;
            border: 1px dashed #c0ccda;
            border-radius: 6px;
            box-sizing: border-box;
            width: 148px;
            height: 148px;
            line-height: 146px;
            vertical-align: top;
            display: inline-block;
            text-align: center;
            cursor: pointer;
            outline: 0;
        }

        .layui-upload-drag-self .layui-icon {
            font-size: 28px;
            color: #8c939d
        }

        .layui-upload-img {
            width: 100%;
            height: 148px;
            border-radius: 6px;
        }


        .handle {
            position: absolute;
            width: 148px;
            height: 148px;
            z-index: 999;
            border-radius: 6px;
            top: 0;
            /* left: 20px; */
            background: rgba(59, 60, 61, 0.6);
            text-align: center;
        }

        .handle .icon-myself {
            z-index: 10;
            transition: all .3s;
            cursor: pointer;
            font-size: 25px;
            width: 25px;
            color: rgba(255, 255, 255, 0.91);
            margin: 0 4px;
        }
    </style>
</head>

<body>
<div class=" clearfix" id="advertising">
    <div id="scrollsidebar" class="left_Treeview">
        <div class="show_btn" id="rightArrow"><span></span></div>
        <div class="widget-box side_content">
            <div class="side_title"><a title="隐藏" class="close_btn"><span></span></a></div>
            <div class="side_list">
                <div class="widget-header header-color-green2">
                    <h4 class="lighter smaller">广告图分类</h4>
                </div>
                <div class="widget-body">
                    <ul class="b_P_Sort_list">
                        <li><i class="orange  fa fa-user-secret"></i><a href="#">全部(235)</a></li>
                        <li><i class="fa fa-image pink "></i> <a href="#">首页轮播广告大(5)</a></li>
                        <li> <i class="fa fa-image pink "></i> <a href="#">轮播广告小1(3)</a> </li>
                        <li> <i class="fa fa-image pink "></i> <a href="#">轮播广告小2(3)</a></li>
                        <li><i class="fa fa-image pink "></i> <a href="#">单个广告(6)</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <div class="Ads_list" id="Ads_list">
        <div class="border clearfix">
					<span class="l_f">
						<a href="javascript:ovid()" id="ads_add" class="btn btn-warning"><i class="fa fa-plus"></i> 添加广告</a>
						<a href="javascript:ovid()" class="btn btn-danger"><i class="fa fa-trash"></i> 批量删除</a>
					</span>
            <span class="r_f">共：<b>{{Ads_count}}</b>条广告</span>
        </div>
        <div class="Ads_lists">
            <table class="table table-striped table-bordered table-hover" id="sample-table">
                <thead>
                <tr>
                    <th width="25"><label><input type="checkbox" class="ace"><span class="lbl"></span></label></th>
                    <th width="80">ID</th>
<!--                    <th>排序</th>-->
                    <th width="100">分类</th>
                    <th width="220px">图片</th>
                    <th width="150px">尺寸（大小）</th>
                    <th width="250px">链接地址</th>
                    <th width="180px">加入时间</th>
                    <th width="70px">状态</th>
                    <th width="250px">操作</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="ad : ${Ads_list}">
                    <td><label><input type="checkbox" class="ace"><span class="lbl"></span></label></td>
                    <td th:text="${ad.id}"></td>
<!--                    <td><input name="" type="text" style=" width:50px" placeholder="" th:placeholder="${ad.id}" /></td>-->
                    <td th:text="${ad.type}"></td>
                    <td><span class="ad_img"><img th:src="@{'../img/'+${ad.picPath}}" width="100%" height="100%" /></span></td>
                    <td th:text="${ad.sizex}+'x'+${ad.sizey}">尺寸</td>
                    <td><a th:href="@{${ad.link}}" target="_blank" th:text="${ad.link}">链接</a></td>
                    <td th:text="${ad.time}">时间</td>


                    <td class="td-status" th:if="${ad.status}==1" ><span class="label label-success radius" >显示</span></td>
                    <td class="td-status" th:if="${ad.status}==0" ><span class="label label-success radius" >停用</span></td>
                    <td class="td-manage">
                        '<a style="text-decoration:none" class="btn btn-xs " th:if="${ad.status}==0" onClick="member_start(this,'10001')" href="javascript:;" title="显示"><i class="fa fa-close bigger-120"></i></a>
<!--                        <a onClick="member_start(this,'10001')" href="javascript:;" th:if="${ad.status}==0" title="启用" class="btn btn-xs btn-success"><i class="fa fa-check  bigger-120"></i></a>-->
                        <a onClick="member_stop(this,'10001')" href="javascript:;" th:if="${ad.status}==1" title="停用" class="btn btn-xs btn-success"><i class="fa fa-check  bigger-120"></i></a>
                        <a title="编辑" onclick="member_edit('编辑','member-add','4','','510')" href="javascript:;" class="btn btn-xs btn-info"><i
                                class="fa fa-edit bigger-120"></i></a>
                        <a title="删除" href="javascript:;" onclick="member_del(this,'1')" class="btn btn-xs btn-warning"><i class="fa fa-trash  bigger-120"></i></a>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
<!--添加广告样式-->
<div id="add_ads_style" style="display:none">
    <div class="add_adverts">
        <ul>
            <li>
                <label class="label_name">所属分类</label>
                <span class="cont_style">
							<select name="sel" id="sel" @change="look" v-model="selectList">
								<option v-for="texts in list" :value="texts.value" ref="newText">{{texts.text}}</option>
							</select>

                    <!-- 			<select class="form-control" id="form-field-select-1" v-model="type">
                        <option value="" >选择分类</option>
                        <option value="AL" >首页大幻灯片</option>
                        <option value="AK" >首页小幻灯片</option>
                        <option value="AZ" >单广告图</option>
                        <option value="AR" >其他广告</option>
                        <option value="CA" >板块栏目广告</option>
                    </select> -->
						</span>
            </li>
            <li><label class="label_name">图片尺寸</label><span class="cont_style">
							<input name="长" type="text" v-model="sizex" id="form-field-1" placeholder="0" class="col-xs-10 col-sm-5" style="width:80px">
							<span class="l_f" style="margin-left:10px;">x</span>
							<input name="宽" type="text" v-model="sizey" id="form-field-1" placeholder="0" class="col-xs-10 col-sm-5" style="width:80px"></span></li>
            <!-- <li> -->
            <!-- 						<label class="label_name">显示排序</label><span class="cont_style"><input name="排序" type="text" id="form-field-1"
                     placeholder="0" class="col-xs-10 col-sm-5" style="width:50px"></span></li> -->
            <li><label class="label_name">链接地址</label><span class="cont_style">
							<input name="地址" type="text" v-model="link" id="form-field-1" placeholder="地址" class="col-xs-10 col-sm-5" style="width:450px">
						</span>
            </li>
            <li><label class="label_name">状&nbsp;&nbsp;态：</label>
                <span class="cont_style">
							&nbsp;&nbsp;
							<label>
								<input name="form-field-radio1" value="1" type="radio" v-model="status" checked="checked" class="ace"><span
                                    class="lbl">显示</span></label>&nbsp;&nbsp;&nbsp;
							<label>
								<input name="form-field-radio1" value="0" v-model="status" type="radio" class="ace"><span class="lbl">隐藏</span></label></span>
                <div class="prompt r_f"></div>
            </li>
            <li><label class="label_name">图片</label>
                <span class="cont_style">
							<div class="layui-input-inline" id="imgItemInfo">
								<div class="layui-upload-drag-self" id="importImg">
									<i class="layui-icon" id="uploadIcon"> &#xe624; </i>
									<div class="layui-hide" id="uploadDemoView">
										<img class="layui-upload-img" id="imgs" src="">
										<div class="handle layui-hide" id="handle">
											<i class="layui-icon icon-myself" id="preImg">1</i>
											<i class="layui-icon icon-myself" id="deleteImg">2</i>
										</div>
									</div>
								</div>
							</div>
							<button type="button" class="layui-btn" id="test9">开始上传</button>
						</span>
            </li>
        </ul>
    </div>
</div>
</body>
</html>

<script th:inline="javascript">
    var add_ads_style = new Vue({
        el: '#add_ads_style',
        data: {
            // type: "CA",
            selectList: "",
            list: [{
                value: '',
                text: "选择分类"
            },
                {
                    value: 'AL',
                    text: "首页大幻灯片"
                },
                {
                    value: 'AK',
                    text: "首页小幻灯片"
                },
                {
                    value: 'AZ',
                    text: "单广告图"
                },
                {
                    value: 'AR',
                    text: "其他广告"
                },
                {
                    value: 'CA',
                    text: "板块栏目广告"
                },
            ],
            type: '',
            sizex: '',
            sizey: '',
            link: '',
            picPath: '',
            status: "1",
        },
        methods: {
            submit: function(index) {
                let self = this;
                var data = {
                    type: this.selectList,
                    sizex: this.sizex,
                    sizey: this.sizey,
                    link: this.link,
                    picPath: this.picPath,
                    status: this.status
                }
                console.log("data")
                console.log(data)

                console.log("type:=$('#imgs')=")
                console.log($('#imgs').attr('src'))
                var formData = new FormData()
                formData.append('type', this.selectList)
                formData.append('sizex', this.sizex)
                formData.append('sizey', this.sizey)
                formData.append('link', this.link)
                formData.append('picPath', this.picPath)
                formData.append('status', this.status)

                $.ajax({
                    url: '/admin/advertise/add',
                    method: 'post',
                    data: formData,
                    contentType: false,
                    processData: false,
                    success: (data) => {
                        if (data.ERROR_CODE == 1) {
                            layer.alert('添加成功！', {
                                title: '提示框',
                                icon: 1,
                            });
                            layer.close(index);
                            location.reload();
                            // $(location).attr("htrf")
                        } else {
                            layer.alert('添加失败！', {
                                title: '提示框',
                                icon: 1,
                            });
                            layer.close(index);
                        }
                    }
                })
                // console.log(data)
                // alert("提交成功")

            },
            checkbox() {
                if (this.selectList == "" || this.sizex == "0" || this.sizex == "" || this.sizey == "0" || this.sizey == "" ||
                    this.link == "" ||
                    this.pricPath == "" || this.status == "") {
                    return false;
                }
                return true;
            },
            look() {

            }
        }
    })

    var ads_list=new Vue({
        el:'#Ads_list',
        data:{
            Ads_list:[[${Ads_list}]],
            Ads_count:[[${Ads_count}]]
        },
        methods: {

        }

    })
</script>

<script type="text/javascript"  th:inline="none">
    //初始化宽度、高度
    $(".widget-box").height($(window).height());
    $(".Ads_list").width($(window).width() - 220);
    //当文档窗口发生改变时 触发
    $(window).resize(function() {
        $(".widget-box").height($(window).height());
        $(".Ads_list").width($(window).width() - 220);
    });
    $(function() {
        $("#advertising").fix({
            float: 'left',
            //minStatue : true,
            skin: 'green',
            durationTime: false,
            stylewidth: '220',
            spacingw: 30, //设置隐藏时的距离
            spacingh: 250, //设置显示时间距
            set_scrollsidebar: '.Ads_style',
            table_menu: '.Ads_list'
        });
    });
    /*广告图片-停用*/
    function member_stop(obj, id) {
        layer.confirm('确认要关闭吗？', {
            icon: 0,
        }, function(index) {
            $(obj).parents("tr").find(".td-manage").prepend(
                '<a style="text-decoration:none" class="btn btn-xs " onClick="member_start(this,id)" href="javascript:;" title="显示"><i class="fa fa-close bigger-120"></i></a>'
            );
            $(obj).parents("tr").find(".td-status").html('<span class="label label-defaunt radius">已关闭</span>');
            $(obj).remove();
            layer.msg('关闭!', {
                icon: 5,
                time: 1000
            });
        });
    }
    /*广告图片-启用*/
    function member_start(obj, id) {
        layer.confirm('确认要显示吗？', {
            icon: 0,
        }, function(index) {
            $(obj).parents("tr").find(".td-manage").prepend(
                '<a style="text-decoration:none" class="btn btn-xs btn-success" onClick="member_stop(this,id)" href="javascript:;" title="关闭"><i class="fa fa-check  bigger-120"></i></a>'
            );
            $(obj).parents("tr").find(".td-status").html('<span class="label label-success radius">显示</span>');
            $(obj).remove();
            layer.msg('显示!', {
                icon: 6,
                time: 1000
            });
        });
    }
    /*广告图片-删除*/
    function member_del(obj, id) {
        layer.confirm('确认要删除吗？', {
            icon: 0,
        }, function(index) {
            $(obj).parents("tr").remove();
            layer.msg('已删除!', {
                icon: 1,
                time: 1000
            });
        });
    }
    /*******添加广告*********/
    $('#ads_add').on('click', function() {
        layer.open({
            type: 1,
            title: '添加广告',
            maxmin: true,
            shadeClose: false, //点击遮罩关闭层
            area: ['800px', ''],
            offset: ['17.6px', ''],
            content: $('#add_ads_style'),
            btn: ['提交', '取消'],
            yes: function(index, layero) {

                var data = {}

                var num = 0;
                var str = "";


                // alert("data")
                console.log(add_ads_style.selectList)

                if (add_ads_style.selectList == "") {
                    layer.alert("类型不能为空！\r\n", {
                        title: '提示框',
                        icon: 0,
                    });
                    num++;
                    return false;
                }

                $(".add_adverts input[type$='text']").each(function(n) {
                    if ($(this).val() == "") {

                        layer.alert(str += "" + $(this).attr("name") + "不能为空！\r\n", {
                            title: '提示框',
                            icon: 0,
                        });
                        num++;
                        return false;
                    }
                });



                if (num > 0) {
                    return false;
                } else {
                    // $(".add_adverts input[type$='text']").each(function(n) {


                    // }
                    if (add_ads_style.checkbox()) {

                        add_ads_style.submit()
                    }

                    // console.log($("#form-field-select-1").value())



                }
            }
        });
    })
</script>





<script type="text/javascript"  th:inline="none">
    layui.use(['form', 'layer', 'upload'], function() {
        var $ = layui.jquery,
            layer = layui.layer,
            upload = layui.upload;

        //删除图片
        $('#deleteImg').on('click', function() {
            $('#uploadDemoView').addClass('layui-hide');
            $('#uploadIcon').removeClass('layui-hide');
            return false;
        });

        //图片预览
        $('#preImg').on('click', function() {
            var iHtml = "<img src='" + $('#imgs').attr('src') + "' style='width: 100%; height: 100%;'/>";
            layer.open({
                type: 1,
                shade: false,
                title: false, //不显示标题
                area: ['40%', '60%'],
                content: iHtml //捕获的元素，注意：最好该指定的元素要存放在body最外层，否则可能被其它的相对元素所影响
            });
            return false;
        });

        //图片绑定鼠标悬浮
        $(document).on("mouseenter", ".layui-upload-drag-self", function() {
            //鼠标悬浮
            $('#handle').removeClass('layui-hide');
        }).on("mouseleave", ".layui-upload-drag-self", function() {
            //鼠标离开
            $('#handle').addClass('layui-hide');
        });

        //拖拽上传
        upload.render({
            elem: '#importImg',
            url: '/post/imageupload', //改成您自己的上传接口
            auto: false,
            bindAction: "#test9",
            choose: function(obj) {
                obj.preview(function(index, file, result) {
                    $('#imgs').attr('src', result);
                    $('#uploadDemoView').removeClass('layui-hide');
                    $('#uploadIcon').addClass('layui-hide');
                });
            },
            done: function(obj) {
                console.log(obj)
                if(obj.ERROR_CODE==1){
                    add_ads_style.picPath = obj.picPath;
                    console.log("add_ads_style.picPath=")
                    console.log(add_ads_style.picPath)

                    $('#imgs').attr('src', "../img/"+obj.picPath);
                    $('#uploadDemoView').removeClass('layui-hide');
                    $('#uploadIcon').addClass('layui-hide');
                    layer.msg('上传成功');
                }else{
                    layer.msg(obj.ERROR_MSSAGE)
                }

                // obj.preview(function(index, file, result) {
                //     add_ads_style.picPath = picPath;
                //     $('#imgs').attr('src', result);
                //     $('#uploadDemoView').removeClass('layui-hide');
                //     $('#uploadIcon').addClass('layui-hide');
                // });
            }
        });

    });

</script>


